<div class="container-fluid">
  <div class="row">

    <!-- Sidebar -->
    <div class="col-md-2 sidebar p-3 bg-light vh-100">
      <h5 class="mb-4">üìÅ File Manager</h5>
      <ul class="nav flex-column">
        <li class="nav-item mb-2">
          <a class="nav-link active" href="#"><i class="fa fa-folder me-2"></i>All Files</a>
        </li>
        <li class="nav-item mb-2">
          <a class="nav-link" href="#"><i class="fa fa-upload me-2"></i>Upload</a>
        </li>
      </ul>
    </div>

    <!-- Main Content -->
    <div class="col-md-10 p-3">

      <!-- Upload & Search -->
      <div class="d-flex flex-wrap align-items-center gap-2 mb-3">
        <input type="file" class="form-control-file" (change)="onFileSelected($event)">
        <button class="btn btn-success" (click)="uploadFile()">
          <i class="fa fa-upload me-1"></i> Upload
        </button>
        <input type="text" class="form-control ms-auto" placeholder="Search files..." [(ngModel)]="searchText" (input)="applyFilter()">
      </div>

      <!-- File Table -->
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th>File</th>
              <th>Type</th>
              <th>Size</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let file of paginatedFiles">
              <!-- File with Icon -->
              <td>
                <i 
                  class="me-2"
                  [ngClass]="{
                    'fa fa-file-pdf-o text-danger': isPdf(file.mimetype),
                    'fa fa-file-word-o text-primary': isWord(file.mimetype),
                    'fa fa-file-excel-o text-success': isExcel(file.mimetype),
                    'fa fa-file-image-o text-warning': isImage(file.mimetype),
                    'fa fa-file-o text-secondary': !canPreview(file)
                  }"></i>
                {{ file.name }}
              </td>

              <td>{{ file.mimetype }}</td>
              <td>{{ (file.size / 1024).toFixed(2) }} KB</td>

              <td>
                <button class="btn btn-info btn-sm me-1" (click)="openPreview(file)" [disabled]="!canPreview(file)">
                  <i class="fa fa-eye"></i>
                </button>
                <button class="btn btn-success btn-sm me-1" (click)="downloadFile(file)">
                  <i class="fa fa-download"></i>
                </button>
                <button class="btn btn-danger btn-sm" (click)="deleteFile(file.id)">
                  <i class="fa fa-trash"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <nav *ngIf="totalPages > 1">
        <ul class="pagination justify-content-center">
          <li class="page-item" [class.disabled]="currentPage === 1">
            <button class="page-link" (click)="changePage(currentPage - 1)">Previous</button>
          </li>
          <li class="page-item" *ngFor="let p of totalPagesArray()" [class.active]="currentPage === p">
            <button class="page-link" (click)="changePage(p)">{{ p }}</button>
          </li>
          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <button class="page-link" (click)="changePage(currentPage + 1)">Next</button>
          </li>
        </ul>
      </nav>

    </div>
  </div>
</div>

<!-- Preview Modal -->
<div class="modal fade" #previewModalRef tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{ selectedFilePreview?.name }}</h5>
        <button type="button" class="btn-close" (click)="closePreview()"></button>
      </div>
      <div class="modal-body text-center">

        <!-- Image Preview -->
        <img *ngIf="selectedFilePreview && isImage(selectedFilePreview.mimetype)"
             [src]="getPreviewUrl(selectedFilePreview)"
             class="img-fluid rounded">

        <!-- PDF Preview -->
        <iframe *ngIf="selectedFilePreview && isPdf(selectedFilePreview.mimetype)"
                [src]="getPreviewUrl(selectedFilePreview)"
                class="w-100" style="height:500px;"></iframe>

        <!-- Word / Excel Preview via Google Docs -->
        <iframe *ngIf="selectedFilePreview && (isWord(selectedFilePreview.mimetype) || isExcel(selectedFilePreview.mimetype))"
                [src]="getPreviewUrl(selectedFilePreview)"
                class="w-100" style="height:500px;"></iframe>

        <!-- Other files -->
        <div *ngIf="selectedFilePreview && !canPreview(selectedFilePreview)">
          <p>Preview not available for this file type.</p>
          <p>Please download to view.</p>
        </div>

      </div>
      <div class="modal-footer">
        <a *ngIf="selectedFilePreview" [href]="fileService.download(selectedFilePreview.id)" target="_blank" class="btn btn-success">
          <i class="fa fa-download me-1"></i> Download
        </a>
        <button type="button" class="btn btn-secondary" (click)="closePreview()">Close</button>
      </div>
    </div>
  </div>
</div>
